<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Lenses.Derive</title><link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css'/><style>.github-fork-ribbon:before { background-color: #333; }</style><link rel="stylesheet" href="css/Agda.css"></head><body><a class='github-fork-ribbon'href='https://github.com/omelkonian/agda-lenses/tree/master///Lenses/Derive.agda'data-ribbon='Source code on Github' title='Source code on Github'>Source code on Github</a><pre class="Agda"><a id="1" class="Comment">-- {-# OPTIONS -v derive-lenses:100 #-}</a>
<a id="41" class="Keyword">module</a> <a id="48" href="Lenses.Derive.html" class="Module">Lenses.Derive</a> <a id="62" class="Keyword">where</a>

<a id="69" class="Keyword">open</a> <a id="74" class="Keyword">import</a> <a id="81" href="Function.html" class="Module">Function</a> <a id="90" class="Keyword">using</a> <a id="96" class="Symbol">(</a><a id="97" href="Function.Base.html#1974" class="Function Operator">_$_</a><a id="100" class="Symbol">)</a>
<a id="102" class="Keyword">open</a> <a id="107" class="Keyword">import</a> <a id="114" href="Data.Unit.html" class="Module">Data.Unit</a> <a id="124" class="Keyword">using</a> <a id="130" class="Symbol">(</a><a id="131" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a><a id="132" class="Symbol">)</a>
<a id="134" class="Keyword">open</a> <a id="139" class="Keyword">import</a> <a id="146" href="Data.List.html" class="Module">Data.List</a> <a id="156" class="Keyword">using</a> <a id="162" class="Symbol">(</a><a id="163" href="Agda.Builtin.List.html#147" class="Datatype">List</a><a id="167" class="Symbol">;</a> <a id="169" href="Data.List.Base.html#3714" class="Function">zip</a><a id="172" class="Symbol">;</a> <a id="174" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">_∷_</a><a id="177" class="Symbol">;</a> <a id="179" href="Data.List.Base.html#7793" class="InductiveConstructor">[]</a><a id="181" class="Symbol">;</a> <a id="183" href="Data.List.Base.html#5244" class="Function Operator">[_]</a><a id="186" class="Symbol">)</a>
<a id="188" class="Keyword">open</a> <a id="193" class="Keyword">import</a> <a id="200" href="Data.Product.html" class="Module">Data.Product</a> <a id="213" class="Keyword">using</a> <a id="219" class="Symbol">(</a><a id="220" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">_,_</a><a id="223" class="Symbol">;</a> <a id="225" href="Data.Product.Base.html#1618" class="Function Operator">_×_</a><a id="228" class="Symbol">)</a>
<a id="230" class="Keyword">open</a> <a id="235" class="Keyword">import</a> <a id="242" href="Data.String.html" class="Module">Data.String</a> <a id="254" class="Keyword">using</a> <a id="260" class="Symbol">(</a><a id="261" href="Agda.Builtin.String.html#335" class="Postulate">String</a><a id="267" class="Symbol">)</a>
<a id="269" class="Keyword">open</a> <a id="274" class="Keyword">import</a> <a id="281" href="Data.Nat.html" class="Module">Data.Nat</a> <a id="290" class="Keyword">using</a> <a id="296" class="Symbol">(</a><a id="297" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="298" class="Symbol">)</a>
<a id="300" class="Keyword">open</a> <a id="305" class="Keyword">import</a> <a id="312" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="350" class="Keyword">using</a> <a id="356" class="Symbol">(</a><a id="357" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">_≡_</a><a id="360" class="Symbol">;</a> <a id="362" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a><a id="366" class="Symbol">)</a>

<a id="369" class="Keyword">open</a> <a id="374" class="Keyword">import</a> <a id="381" href="Reflection.html" class="Module">Reflection</a> <a id="392" class="Keyword">hiding</a> <a id="399" class="Symbol">(</a><a id="400" href="Reflection.TCM.Syntax.html#623" class="Function Operator">_&gt;&gt;=_</a><a id="405" class="Symbol">;</a> <a id="407" href="Reflection.TCM.Syntax.html#693" class="Function Operator">_&gt;&gt;_</a><a id="411" class="Symbol">)</a>
<a id="413" class="Keyword">open</a> <a id="418" class="Keyword">import</a> <a id="425" href="Reflection.AST.Meta.html" class="Module">Reflection.AST.Meta</a>

<a id="446" class="Keyword">open</a> <a id="451" class="Keyword">import</a> <a id="458" href="Reflection.Utils.Debug.html" class="Module">Reflection.Utils.Debug</a>
<a id="481" class="Keyword">open</a> <a id="486" class="Keyword">import</a> <a id="493" href="Reflection.Syntax.html" class="Module">Reflection.Syntax</a>
<a id="511" class="Keyword">open</a> <a id="516" class="Keyword">import</a> <a id="523" href="Reflection.Utils.html" class="Module">Reflection.Utils</a>
<a id="540" class="Keyword">open</a> <a id="545" href="Reflection.Utils.Debug.html#574" class="Module">Debug</a> <a id="551" class="Symbol">(</a><a id="552" class="String">&quot;derive-lenses&quot;</a> <a id="568" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="570" class="Number">100</a><a id="573" class="Symbol">)</a>

<a id="576" class="Keyword">open</a> <a id="581" class="Keyword">import</a> <a id="588" href="Class.Show.html" class="Module">Class.Show</a>
<a id="599" class="Keyword">open</a> <a id="604" class="Keyword">import</a> <a id="611" href="Class.Semigroup.html" class="Module">Class.Semigroup</a>
<a id="627" class="Keyword">open</a> <a id="632" class="Keyword">import</a> <a id="639" href="Class.Monad.html" class="Module">Class.Monad</a>

<a id="652" class="Keyword">open</a> <a id="657" class="Keyword">import</a> <a id="664" href="Lenses.Core.html" class="Module">Lenses.Core</a>

<a id="deriveLenses"></a><a id="677" href="Lenses.Derive.html#677" class="Function">deriveLenses</a> <a id="690" class="Symbol">:</a> <a id="692" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="697" class="Symbol">→</a> <a id="699" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="704" class="Symbol">(</a><a id="705" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="710" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="712" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="717" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="719" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="724" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="726" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a><a id="730" class="Symbol">)</a> <a id="732" class="Symbol">→</a> <a id="734" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="737" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a>
<a id="739" href="Lenses.Derive.html#677" class="Function">deriveLenses</a> <a id="752" href="Lenses.Derive.html#752" class="Bound">n</a> <a id="754" href="Lenses.Derive.html#754" class="Bound">lns</a> <a id="758" class="Symbol">=</a> <a id="760" class="Keyword">do</a>
  <a id="765" href="Reflection.Utils.Debug.html#694" class="Function">print</a> <a id="771" class="String">&quot;**************************&quot;</a>
  <a id="802" href="Reflection.Utils.Debug.html#694" class="Function">print</a> <a id="808" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="810" class="String">&quot;Deriving lenses for &quot;</a> <a id="833" href="Class.Semigroup.Core.html#164" class="Field Operator">◇</a> <a id="835" href="Class.Show.Core.html#178" class="Field">show</a> <a id="840" href="Lenses.Derive.html#752" class="Bound">n</a>
  <a id="844" href="Lenses.Derive.html#844" class="Bound">d</a><a id="845" class="Symbol">@(</a><a id="847" href="Agda.Builtin.Reflection.html#7617" class="InductiveConstructor">record-type</a> <a id="859" class="Symbol">_</a> <a id="861" href="Lenses.Derive.html#861" class="Bound">fs</a><a id="863" class="Symbol">)</a> <a id="865" href="Class.Monad.Core.html#290" class="Field Operator">←</a> <a id="867" href="Agda.Builtin.Reflection.html#9732" class="Postulate">getDefinition</a> <a id="881" href="Lenses.Derive.html#752" class="Bound">n</a>
    <a id="887" class="Keyword">where</a> <a id="893" class="CatchallClause Symbol">_</a> <a id="895" class="Symbol">→</a> <a id="897" href="Reflection.Utils.Debug.html#456" class="Function">error</a> <a id="903" class="String">&quot;Not a record type&quot;</a>
  <a id="925" href="Reflection.Utils.Debug.html#694" class="Function">print</a> <a id="931" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="933" class="String">&quot;fields: &quot;</a> <a id="944" href="Class.Semigroup.Core.html#164" class="Field Operator">◇</a> <a id="946" href="Class.Show.Core.html#178" class="Field">show</a> <a id="951" href="Lenses.Derive.html#861" class="Bound">fs</a>
  <a id="956" class="Keyword">let</a> <a id="960" href="Lenses.Derive.html#960" class="Bound">fs</a> <a id="963" class="Symbol">=</a> <a id="965" href="Reflection.Utils.html#5912" class="Function">vArgs</a> <a id="971" href="Lenses.Derive.html#861" class="Bound">fs</a>
  <a id="976" href="Class.Monad.Core.html#1151" class="Function">return⊤</a> <a id="984" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="986" href="Class.Monad.Core.html#932" class="Function">forM</a> <a id="991" class="Symbol">(</a><a id="992" href="Data.List.Base.html#3714" class="Function">zip</a> <a id="996" href="Lenses.Derive.html#960" class="Bound">fs</a> <a id="999" href="Lenses.Derive.html#754" class="Bound">lns</a><a id="1002" class="Symbol">)</a> <a id="1004" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="1006" class="Symbol">λ</a> <a id="1008" class="Keyword">where</a> <a id="1014" class="Symbol">(</a><a id="1015" href="Lenses.Derive.html#1015" class="Bound">f</a> <a id="1017" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1019" class="Symbol">(</a><a id="1020" href="Lenses.Derive.html#1020" class="Bound">ln</a> <a id="1023" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1025" href="Lenses.Derive.html#1025" class="Bound">gn</a> <a id="1028" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1030" href="Lenses.Derive.html#1030" class="Bound">sn</a> <a id="1033" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1035" href="Lenses.Derive.html#1035" class="Bound">mn</a><a id="1037" class="Symbol">))</a> <a id="1040" class="Symbol">→</a> <a id="1042" class="Keyword">do</a>
    <a id="1049" class="Symbol">(</a><a id="1050" href="Agda.Builtin.Reflection.html#5426" class="InductiveConstructor">pi</a> <a id="1053" class="Symbol">_</a> <a id="1055" class="Symbol">(</a><a id="1056" href="Agda.Builtin.Reflection.html#4285" class="InductiveConstructor">abs</a> <a id="1060" class="Symbol">_</a> <a id="1062" href="Lenses.Derive.html#1062" class="Bound">fTy</a><a id="1065" class="Symbol">))</a> <a id="1068" href="Class.Monad.Core.html#290" class="Field Operator">←</a> <a id="1070" href="Agda.Builtin.Reflection.html#9696" class="Postulate">getType</a> <a id="1078" href="Lenses.Derive.html#1015" class="Bound">f</a>
      <a id="1086" class="Keyword">where</a> <a id="1092" class="CatchallClause Symbol">_</a> <a id="1094" class="Symbol">→</a> <a id="1096" href="Reflection.Utils.Debug.html#456" class="Function">error</a> <a id="1102" class="String">&quot;Not a field type (should be `&lt;RECORD&gt; → &lt;FIELD&gt;`).&quot;</a>
    <a id="1159" href="Reflection.Utils.Debug.html#1554" class="Function">genSimpleDef</a> <a id="1172" href="Lenses.Derive.html#1020" class="Bound">ln</a> <a id="1175" class="Symbol">(</a><a id="1176" class="Keyword">quote</a> <a id="1182" href="Lenses.Core.html#390" class="Record">Lens</a> <a id="1187" href="Reflection.Syntax.html#2963" class="InductiveConstructor Operator">∙⟦</a> <a id="1190" href="Lenses.Derive.html#752" class="Bound">n</a> <a id="1192" href="Reflection.Syntax.html#2899" class="InductiveConstructor Operator">∙</a> <a id="1194" href="Reflection.Syntax.html#2963" class="InductiveConstructor Operator">∣</a> <a id="1196" href="Lenses.Derive.html#1062" class="Bound">fTy</a> <a id="1200" href="Reflection.Syntax.html#2963" class="InductiveConstructor Operator">⟧</a><a id="1201" class="Symbol">)</a> <a id="1203" href="Function.Base.html#1974" class="Function Operator">$</a>
     <a id="1210" href="Reflection.Utils.html#6985" class="Function">mkRecord</a> <a id="1219" class="Symbol">(</a> <a id="1221" class="Symbol">(</a><a id="1222" class="Keyword">quote</a> <a id="1228" href="Lenses.Core.html#419" class="Field">Lens.get</a> <a id="1237" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1239" href="Lenses.Derive.html#1015" class="Bound">f</a> <a id="1241" href="Reflection.Syntax.html#2899" class="InductiveConstructor Operator">∙</a><a id="1242" class="Symbol">)</a>
              <a id="1258" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1260" class="Symbol">(</a><a id="1261" class="Keyword">quote</a> <a id="1267" href="Lenses.Core.html#440" class="Field">Lens.set</a> <a id="1276" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1278" href="Reflection.Syntax.html#2286" class="InductiveConstructor Operator">`λ⟦</a> <a id="1282" class="String">&quot;r&quot;</a> <a id="1286" href="Reflection.Syntax.html#2286" class="InductiveConstructor Operator">∣</a> <a id="1288" class="String">&quot;x′&quot;</a> <a id="1293" href="Reflection.Syntax.html#2286" class="InductiveConstructor Operator">⇒</a> <a id="1295" href="Reflection.Utils.html#7109" class="Function">updateField</a> <a id="1307" href="Lenses.Derive.html#960" class="Bound">fs</a> <a id="1310" class="Symbol">(</a><a id="1311" href="Reflection.Syntax.html#1452" class="InductiveConstructor">♯</a> <a id="1313" class="Number">1</a><a id="1314" class="Symbol">)</a> <a id="1316" href="Lenses.Derive.html#1015" class="Bound">f</a> <a id="1318" class="Symbol">(</a><a id="1319" href="Reflection.Syntax.html#1452" class="InductiveConstructor">♯</a> <a id="1321" class="Number">0</a><a id="1322" class="Symbol">)</a> <a id="1324" href="Reflection.Syntax.html#2286" class="InductiveConstructor Operator">⟧</a><a id="1325" class="Symbol">)</a>
              <a id="1341" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1343" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="1345" class="Symbol">)</a>
    <a id="1351" href="Reflection.Utils.Debug.html#1554" class="Function">genSimpleDef</a> <a id="1364" href="Lenses.Derive.html#1025" class="Bound">gn</a> <a id="1367" class="Symbol">(</a><a id="1368" class="Keyword">quote</a> <a id="1374" href="Lenses.Core.html#269" class="Function">Getter</a> <a id="1381" href="Reflection.Syntax.html#2963" class="InductiveConstructor Operator">∙⟦</a> <a id="1384" href="Lenses.Derive.html#752" class="Bound">n</a> <a id="1386" href="Reflection.Syntax.html#2899" class="InductiveConstructor Operator">∙</a> <a id="1388" href="Reflection.Syntax.html#2963" class="InductiveConstructor Operator">∣</a> <a id="1390" href="Lenses.Derive.html#1062" class="Bound">fTy</a> <a id="1394" href="Reflection.Syntax.html#2963" class="InductiveConstructor Operator">⟧</a><a id="1395" class="Symbol">)</a> <a id="1397" href="Function.Base.html#1974" class="Function Operator">$</a>
      <a id="1405" class="Keyword">quote</a> <a id="1411" href="Lenses.Core.html#419" class="Field">Lens.get</a> <a id="1420" href="Reflection.Syntax.html#2923" class="InductiveConstructor Operator">∙⟦</a> <a id="1423" href="Lenses.Derive.html#1020" class="Bound">ln</a> <a id="1426" href="Reflection.Syntax.html#2899" class="InductiveConstructor Operator">∙</a> <a id="1428" href="Reflection.Syntax.html#2923" class="InductiveConstructor Operator">⟧</a>
    <a id="1434" href="Reflection.Utils.Debug.html#1554" class="Function">genSimpleDef</a> <a id="1447" href="Lenses.Derive.html#1030" class="Bound">sn</a> <a id="1450" class="Symbol">(</a><a id="1451" class="Keyword">quote</a> <a id="1457" href="Lenses.Core.html#301" class="Function">Setter</a> <a id="1464" href="Reflection.Syntax.html#2963" class="InductiveConstructor Operator">∙⟦</a> <a id="1467" href="Lenses.Derive.html#752" class="Bound">n</a> <a id="1469" href="Reflection.Syntax.html#2899" class="InductiveConstructor Operator">∙</a> <a id="1471" href="Reflection.Syntax.html#2963" class="InductiveConstructor Operator">∣</a> <a id="1473" href="Lenses.Derive.html#1062" class="Bound">fTy</a> <a id="1477" href="Reflection.Syntax.html#2963" class="InductiveConstructor Operator">⟧</a><a id="1478" class="Symbol">)</a> <a id="1480" href="Function.Base.html#1974" class="Function Operator">$</a>
      <a id="1488" class="Keyword">quote</a> <a id="1494" href="Lenses.Core.html#440" class="Field">Lens.set</a> <a id="1503" href="Reflection.Syntax.html#2923" class="InductiveConstructor Operator">∙⟦</a> <a id="1506" href="Lenses.Derive.html#1020" class="Bound">ln</a> <a id="1509" href="Reflection.Syntax.html#2899" class="InductiveConstructor Operator">∙</a> <a id="1511" href="Reflection.Syntax.html#2923" class="InductiveConstructor Operator">⟧</a>
    <a id="1517" href="Reflection.Utils.Debug.html#1554" class="Function">genSimpleDef</a> <a id="1530" href="Lenses.Derive.html#1035" class="Bound">mn</a> <a id="1533" class="Symbol">(</a><a id="1534" class="Keyword">quote</a> <a id="1540" href="Lenses.Core.html#337" class="Function">Modifier</a> <a id="1549" href="Reflection.Syntax.html#2963" class="InductiveConstructor Operator">∙⟦</a> <a id="1552" href="Lenses.Derive.html#752" class="Bound">n</a> <a id="1554" href="Reflection.Syntax.html#2899" class="InductiveConstructor Operator">∙</a> <a id="1556" href="Reflection.Syntax.html#2963" class="InductiveConstructor Operator">∣</a> <a id="1558" href="Lenses.Derive.html#1062" class="Bound">fTy</a> <a id="1562" href="Reflection.Syntax.html#2963" class="InductiveConstructor Operator">⟧</a><a id="1563" class="Symbol">)</a> <a id="1565" href="Function.Base.html#1974" class="Function Operator">$</a>
      <a id="1573" class="Keyword">quote</a> <a id="1579" href="Lenses.Core.html#456" class="Function">Lens.modify</a> <a id="1591" href="Reflection.Syntax.html#2923" class="InductiveConstructor Operator">∙⟦</a> <a id="1594" href="Lenses.Derive.html#1020" class="Bound">ln</a> <a id="1597" href="Reflection.Syntax.html#2899" class="InductiveConstructor Operator">∙</a> <a id="1599" href="Reflection.Syntax.html#2923" class="InductiveConstructor Operator">⟧</a>
</pre></body></html>